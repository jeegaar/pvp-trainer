<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PVP Trainer — Homepage</title>
  <style>
    body{margin:0;height:100vh;display:flex;justify-content:center;align-items:center;background:#111;font-family:Arial,sans-serif;color:#fff}
    .container{text-align:center;background:#1c1c1c;padding:40px;border-radius:12px;box-shadow:0 0 20px rgba(0,0,0,.6);width:500px}
    h1{margin-bottom:30px;font-size:28px;color:#f1c40f}
    h1 a{color:#f1c40f;text-decoration:none}
    h1 a:hover{color:#ffd700;text-decoration:underline}
    .form-group{margin-bottom:20px;text-align:left}
    label{display:block;margin-bottom:8px;font-size:14px;color:#ccc}
    input{width:100%;padding:10px;border-radius:6px;border:none;font-size:16px}
    .buttons{margin-top:30px;display:flex;justify-content:space-between;gap:20px}
    button{flex:1;padding:10px;font-size:16px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:background .2s}
    .create-btn{background:#27ae60;color:#fff}.create-btn:hover{background:#2ecc71}
    .join-btn{background:#2980b9;color:#fff}.join-btn:hover{background:#3498db}
    .notifications{margin-top:20px;text-align:left}
    .notification{background:#333;padding:8px;margin-bottom:10px;border-radius:6px;font-size:14px}
    .error{background:#7a2d2d}
    .rooms{margin-top:30px;text-align:left}
    .rooms h3{margin-bottom:10px;color:#f1c40f}
    .room{background:#222;padding:10px;border-radius:6px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
    .room span{font-size:14px}
    .room button{background:#3498db;color:#fff;padding:6px 10px;border-radius:6px;font-size:14px}
    .room button:hover{background:#2980b9}
    .full-label{color:#aaa;font-size:14px}
  </style>
</head>
<body>
  <div class="container">
    <h1>
      PVP Trainer — by
      <a href="https://tibiantis.online/?page=character&name=jegaar" target="_blank">Jegaar</a>
    </h1>

    <div class="form-group">
      <label for="nickname">Player Nickname</label>
      <input type="text" id="nickname" placeholder="Enter your nickname" />
    </div>

    <div class="form-group">
      <label for="roomId">Room ID</label>
      <input type="text" id="roomId" placeholder="Enter room ID" />
    </div>

    <div class="buttons">
      <button class="create-btn" id="createRoom">Create Room</button>
      <button class="join-btn" id="joinRoom">Join Room</button>
    </div>

    <div class="rooms">
      <h3>Active Rooms</h3>
      <div id="roomList">Loading...</div>
    </div>

    <div class="notifications" id="notifications"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    function notify(msg, isErr=false){
      const n=document.createElement('div');
      n.className='notification'+(isErr?' error':'');
      n.textContent=msg;
      document.getElementById('notifications').prepend(n);
    }

    function goGame(roomId, nickname, action){
      const qs = `room=${encodeURIComponent(roomId)}&nick=${encodeURIComponent(nickname)}&action=${action}`;
      window.location.href = `/game.html?${qs}`;
    }

    document.getElementById("createRoom").onclick = () => {
      const nickname=document.getElementById("nickname").value.trim();
      const roomId=document.getElementById("roomId").value.trim();
      if(!nickname||!roomId) return notify("Please enter nickname and room ID.", true);
      goGame(roomId, nickname, "create");
    };

    document.getElementById("joinRoom").onclick = () => {
      const nickname=document.getElementById("nickname").value.trim();
      const roomId=document.getElementById("roomId").value.trim();
      if(!nickname||!roomId) return notify("Please enter nickname and room ID.", true);
      goGame(roomId, nickname, "join");
    };

    // === Active rooms list ===
    socket.emit("getRooms", (rooms)=>renderRooms(rooms));
    socket.on("roomsUpdate",(rooms)=>renderRooms(rooms));

    function renderRooms(rooms){
      const c=document.getElementById("roomList");
      c.innerHTML="";
      if(!rooms || rooms.length===0){ c.textContent="No active rooms."; return; }

      rooms.forEach(r=>{
        const div=document.createElement("div");
        div.className="room";
        let players = r.players.join(" vs ");
        if(r.players.length===1){
          div.innerHTML=`<span>Room <b>${r.roomId}</b> (${players})</span>
            <button onclick="tryJoinRoom('${r.roomId}')">Join</button>`;
        } else {
          div.innerHTML=`<span>Room <b>${r.roomId}</b> (${players})</span>
            <span class="full-label">Full</span>`;
        }
        c.appendChild(div);
      });
    }

    function tryJoinRoom(roomId){
      const nickname=document.getElementById("nickname").value.trim();
      if(!nickname){
        notify("Please enter your nickname before joining a room.", true);
        return;
      }
      goGame(roomId, nickname, "join");
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PVP Trainer â€” Homepage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{margin:0;height:100vh;display:flex;justify-content:center;align-items:center;background:#111;font-family:Arial,sans-serif;color:#fff}
    .container{text-align:center;background:#1c1c1c;padding:40px;border-radius:12px;box-shadow:0 0 20px rgba(0,0,0,.6);width:400px}
    h1{margin-bottom:30px;font-size:28px;color:#f1c40f}
    h1 a{color:#f1c40f;text-decoration:none}
    h1 a:hover{color:#ffd700;text-decoration:underline}
    .form-group{margin-bottom:20px;text-align:left}
    label{display:block;margin-bottom:8px;font-size:14px;color:#ccc}
    input{width:100%;padding:10px;border-radius:6px;border:none;font-size:16px}
    .buttons{margin-top:30px;display:flex;justify-content:space-between;gap:20px}
    button{flex:1;padding:12px;font-size:16px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:background .2s}
    .create-btn{background:#27ae60;color:#fff}.create-btn:hover{background:#2ecc71}
    .join-btn{background:#2980b9;color:#fff}.join-btn:hover{background:#3498db}
    .notifications{margin-top:30px;text-align:left}
    .notification{background:#333;padding:12px;margin-bottom:10px;border-radius:6px;font-size:14px}
    .error{background:#7a2d2d}
  </style>
</head>
<body>
  <div class="container">
    <h1>
      PVP Trainer â€” by
      <a href="https://tibiantis.online/?page=character&name=jegaar" target="_blank" rel="noopener">Jegaar</a>
    </h1>

    <div class="form-group">
      <label for="nickname">Player Nickname</label>
      <input type="text" id="nickname" placeholder="Enter your nickname" />
    </div>

    <div class="form-group">
      <label for="roomId">Room ID</label>
      <input type="text" id="roomId" placeholder="Enter room ID (e.g. arena-123)" />
    </div>

    <div class="buttons">
      <button class="create-btn" id="createRoom">Create Room</button>
      <button class="join-btn" id="joinRoom">Join Room</button>
    </div>

    <div class="notifications" id="notifications">
      <div class="notification">ðŸ”” Sample notification: Room created successfully!</div>
    </div>
    <div class="rooms" style="margin-top:20px;text-align:left;">
  <h3 style="color:#f1c40f;">Active Rooms</h3>
  <div id="roomList">Loadingâ€¦</div>
</div>

  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const notify = (msg, isErr=false) => {
      const n = document.createElement('div');
      n.className = 'notification' + (isErr ? ' error' : '');
      n.textContent = msg;
      document.getElementById('notifications').prepend(n);
    };

    const goGame = (roomId, nickname) => {
      const qs = `room=${encodeURIComponent(roomId)}&nick=${encodeURIComponent(nickname)}`;
      window.location.href = `/game.html?${qs}`;
    };

    document.getElementById("createRoom").onclick = () => {
      const nickname = document.getElementById("nickname").value.trim();
      const roomId = document.getElementById("roomId").value.trim();
      if (!nickname || !roomId) return notify("Please enter nickname and room ID.", true);

      socket.emit("createRoom", { roomId, nickname }, (res) => {
        if (res.success) {
          notify(`Room ${roomId} created. Joining...`);
          goGame(roomId, nickname);
        } else {
          notify(res.message || "Failed to create room.", true);
        }
      });
    };

    document.getElementById("joinRoom").onclick = () => {
      const nickname = document.getElementById("nickname").value.trim();
      const roomId = document.getElementById("roomId").value.trim();
      if (!nickname || !roomId) return notify("Please enter nickname and room ID.", true);

      socket.emit("joinRoom", { roomId, nickname }, (res) => {
        if (res.success) {
          notify(`Joining room ${roomId}...`);
          goGame(roomId, nickname);
        } else {
          notify(res.message || "Failed to join room.", true);
        }
      });
    };
    function renderRooms(rooms) {
  const c = document.getElementById("roomList");
  c.innerHTML = "";
      
  if (!rooms || rooms.length === 0) {
    c.textContent = "No active rooms.";
    return;
  }
      // Add column headers
const header = document.createElement("div");
header.style.display = "flex";
header.style.justifyContent = "space-between";
header.style.fontWeight = "bold";
header.style.marginBottom = "6px";
header.innerHTML = "<span style='flex:1'>Room ID</span><span style='flex:1'>Player 1</span><span style='flex:1'>Player 2</span>";
c.appendChild(header);


  const ul = document.createElement("ul");
  rooms.forEach(r => {
    const li = document.createElement("li");
    li.textContent = `Room ${r.roomId} | ${r.player1} | ${r.player2}`;
    ul.appendChild(li);
  });
  c.appendChild(ul);
}

// Ask server once on load
socket.emit("getRooms", (rooms) => renderRooms(rooms));

// Keep updated automatically
socket.on("roomsUpdate", (rooms) => renderRooms(rooms));

  </script>
</body>
</html>
